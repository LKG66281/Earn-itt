<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #0d0d0d;
      color: #fff;
    }

    .container {
      max-width: 400px;
      margin: 100px auto;
      padding: 20px;
      background: #1c1c1c;
      border-radius: 10px;
      box-shadow: 0 0 15px #0ff;
      text-align: center;
    }

    input, button {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      border: none;
      border-radius: 5px;
      background: #2c2c2c;
      color: #fff;
    }

    button {
      background: #0ff;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }

    .dashboard {
      display: flex;
      height: 100vh;
      position: relative;
    }

    .profile-circle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      overflow: hidden;
      border: 2px solid #0ff;
      margin: 10px;
      cursor: pointer;
    }

    .profile-circle img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .sidebar {
      width: 60px;
      background: #111;
      display: flex;
      align-items: flex-start;
      padding: 10px;
    }

    .slide-panel {
      position: fixed;
      top: 0;
      right: -300px;
      width: 300px;
      height: 100%;
      background: #1c1c1c;
      box-shadow: -5px 0 15px #0ff;
      padding: 20px;
      transition: right 0.3s ease;
      z-index: 10;
    }

    .slide-panel.show {
      right: 0;
    }

    .glow-box {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #111;
      padding: 15px 25px;
      border-radius: 8px;
      color: #0ff;
      font-weight: bold;
      box-shadow: 0 0 20px #0ff;
      display: none;
      z-index: 999;
    }
  </style>
</head>
<body>

<div class="container" id="auth-container">
  <h2 id="auth-title">Login</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button id="auth-btn">Login</button>
  <p><a href="#" id="toggle-auth">Don't have an account? Sign up</a></p>
</div>

<div class="dashboard hidden" id="dashboard">
  <div class="sidebar">
    <div class="profile-circle" id="profile-circle">
      <img src="https://via.placeholder.com/60" id="profile-pic" />
    </div>
  </div>
</div>

<div class="slide-panel" id="slide-panel">
  <h3>Update Profile</h3>
  <input type="file" id="profile-img-input">
  <input type="text" id="username" placeholder="Username">
  <input type="text" id="bio" placeholder="Bio">
  <button id="save-profile">Save</button>
</div>

<div class="glow-box" id="message-box">Message</div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDs2taPm-p2O-dYdBToYwq7vZBUSDNISyg",
    authDomain: "earn-itt.firebaseapp.com",
    projectId: "earn-itt",
    storageBucket: "earn-itt.appspot.com",
    messagingSenderId: "785360520679",
    appId: "1:785360520679:web:ac2e2710ece34591a52942",
    measurementId: "G-P4Q2KYTBBM"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);

  const emailInput = document.getElementById("email");
  const passInput = document.getElementById("password");
  const authBtn = document.getElementById("auth-btn");
  const toggleAuth = document.getElementById("toggle-auth");
  const authContainer = document.getElementById("auth-container");
  const dashboard = document.getElementById("dashboard");
  const profileCircle = document.getElementById("profile-circle");
  const profilePic = document.getElementById("profile-pic");
  const slidePanel = document.getElementById("slide-panel");
  const usernameInput = document.getElementById("username");
  const bioInput = document.getElementById("bio");
  const profileImgInput = document.getElementById("profile-img-input");
  const saveProfile = document.getElementById("save-profile");
  const messageBox = document.getElementById("message-box");

  let isLogin = true;
  let currentUser = null;

  toggleAuth.onclick = () => {
    isLogin = !isLogin;
    document.getElementById("auth-title").textContent = isLogin ? "Login" : "Sign Up";
    authBtn.textContent = isLogin ? "Login" : "Sign Up";
    toggleAuth.textContent = isLogin ? "Don't have an account? Sign up" : "Already have an account? Login";
  };

  function showMessage(msg) {
    messageBox.textContent = msg;
    messageBox.style.display = "block";
    setTimeout(() => messageBox.style.display = "none", 3000);
  }

  authBtn.onclick = async () => {
    const email = emailInput.value;
    const pass = passInput.value;
    try {
      if (isLogin) {
        await signInWithEmailAndPassword(auth, email, pass);
        showMessage("✅ Successfully logged in!");
      } else {
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        await setDoc(doc(db, "users", cred.user.uid), {
          username: "New User",
          bio: "",
          imageUrl: ""
        });
        showMessage("✅ Account created!");
      }
    } catch (e) {
      showMessage("❌ " + e.message);
    }
  };

  onAuthStateChanged(auth, async user => {
    if (user) {
      currentUser = user;
      authContainer.classList.add("hidden");
      dashboard.classList.remove("hidden");

      const snap = await getDoc(doc(db, "users", user.uid));
      if (snap.exists()) {
        const data = snap.data();
        if (data.imageUrl) {
          profilePic.src = data.imageUrl;
        }
        usernameInput.value = data.username || "";
        bioInput.value = data.bio || "";
      }
    }
  });

  profileCircle.onclick = () => {
    slidePanel.classList.toggle("show");
  };

  saveProfile.onclick = async () => {
    let imageUrl = null;

    if (profileImgInput.files.length > 0) {
      const file = profileImgInput.files[0];
      const storageRef = ref(storage, `profiles/${currentUser.uid}`);
      await uploadBytes(storageRef, file);
      imageUrl = await getDownloadURL(storageRef);
      profilePic.src = imageUrl;
    }

    const data = {};
    if (usernameInput.value) data.username = usernameInput.value;
    if (bioInput.value) data.bio = bioInput.value;
    if (imageUrl) data.imageUrl = imageUrl;

    await updateDoc(doc(db, "users", currentUser.uid), data);
    showMessage("✅ Profile updated!");
    slidePanel.classList.remove("show");
  };
</script>
</body>
</html>
