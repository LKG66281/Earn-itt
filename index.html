<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ðŸ”¥ Neon Tic-Tac-Toe</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #0f0f0f;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .neon-btn, input, button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 1rem;
      background: black;
      color: #0ff;
      border: 2px solid #0ff;
      border-radius: 8px;
      box-shadow: 0 0 10px #0ff;
      cursor: pointer;
    }
    input {
      background: #111;
      color: #0ff;
      border: 1px solid #0ff;
    }
    .hidden { display: none; }
    .container {
      text-align: center;
      max-width: 400px;
      width: 90%;
    }
    .message {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #111;
      padding: 10px 20px;
      color: #0ff;
      border: 2px solid #0ff;
      border-radius: 8px;
      box-shadow: 0 0 20px #0ff;
      z-index: 100;
      animation: fade 2s forwards;
    }
    @keyframes fade {
      0% { opacity: 1; }
      100% { opacity: 0; bottom: 10px; }
    }
    .board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 5px;
      margin: 20px auto;
      width: 300px;
    }
    .cell {
      width: 100px;
      height: 100px;
      font-size: 3rem;
      background: #111;
      color: #0ff;
      border: 2px solid #0ff;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="app" class="container">
    <div id="auth">
      <h2 id="authTitle">Login</h2>
      <input id="email" placeholder="Email"><br>
      <input id="password" type="password" placeholder="Password"><br>
      <button id="authBtn" class="neon-btn" onclick="authAction()">Login</button>
      <button class="neon-btn" onclick="toggleAuth()">Switch to Signup</button>
    </div>

    <div id="dashboard" class="hidden">
      <h2>Welcome, <span id="usernameDisplay">User</span></h2>
      <input id="usernameInput" placeholder="Set username">
      <button class="neon-btn" onclick="saveUsername()">Save Username</button><br>
      <button class="neon-btn" onclick="gotoMode()">â–¶ Play</button>
    </div>

    <div id="modeSelect" class="hidden">
      <h2>Select Game Mode</h2>
      <button class="neon-btn" onclick="playFriend()">Play with Friend</button>
      <button class="neon-btn" onclick="playRandom()">Play with Random Player</button>
    </div>

    <div id="friendMode" class="hidden">
      <h3>Friend Mode</h3>
      <button class="neon-btn" onclick="createRoom()">Create Room</button><br>
      <input id="roomIdInput" placeholder="Enter Room ID">
      <button class="neon-btn" onclick="joinRoom()">Join Room</button>
      <p id="roomIdDisplay"></p>
    </div>

    <div id="game" class="hidden">
      <h3 id="playerTurn"></h3>
      <div class="board" id="board"></div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDs2taPm-p2O-dYdBToYwq7vZBUSDNISyg",
      authDomain: "earn-itt.firebaseapp.com",
      projectId: "earn-itt",
      storageBucket: "earn-itt.firebasestorage.app",
      messagingSenderId: "785360520679",
      appId: "1:785360520679:web:ac2e2710ece34591a52942",
      measurementId: "G-P4Q2KYTBBM"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let isLogin = true;
    let currentUser = null;
    let currentRoom = null;
    let isMyTurn = false;

    const showMessage = msg => {
      const m = document.createElement('div');
      m.className = 'message';
      m.innerText = msg;
      document.body.appendChild(m);
      setTimeout(() => m.remove(), 2000);
    };

    const toggleAuth = () => {
      isLogin = !isLogin;
      document.getElementById("authTitle").innerText = isLogin ? "Login" : "Sign Up";
      document.getElementById("authBtn").innerText = isLogin ? "Login" : "Sign Up";
    };

    const authAction = () => {
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;

      if (!email || !pass) {
        showMessage("Email and password required");
        return;
      }

      const action = isLogin ? auth.signInWithEmailAndPassword : auth.createUserWithEmailAndPassword;
      action(email, pass).then(({ user }) => {
        currentUser = user;
        document.getElementById("auth").classList.add("hidden");
        document.getElementById("dashboard").classList.remove("hidden");
        loadUsername();
        showMessage("Logged in!");
      }).catch(e => showMessage(e.message));
    };

    const saveUsername = () => {
      const name = document.getElementById("usernameInput").value;
      db.collection("users").doc(currentUser.uid).set({ username: name });
      document.getElementById("usernameDisplay").innerText = name;
      showMessage("Username saved!");
    };

    const loadUsername = () => {
      db.collection("users").doc(auth.currentUser.uid).get().then(doc => {
        const name = doc.data()?.username || "User";
        document.getElementById("usernameDisplay").innerText = name;
      });
    };

    const gotoMode = () => {
      document.getElementById("dashboard").classList.add("hidden");
      document.getElementById("modeSelect").classList.remove("hidden");
    };

    const playFriend = () => {
      document.getElementById("modeSelect").classList.add("hidden");
      document.getElementById("friendMode").classList.remove("hidden");
    };

    const createRoom = () => {
      const id = Math.random().toString(36).substr(2, 5);
      db.collection("rooms").doc(id).set({
        players: [auth.currentUser.uid],
        board: Array(9).fill(""),
        turn: auth.currentUser.uid
      });
      currentRoom = id;
      document.getElementById("roomIdDisplay").innerText = "Room ID: " + id;
      waitForOpponent(id);
    };

    const joinRoom = () => {
      const id = document.getElementById("roomIdInput").value;
      const ref = db.collection("rooms").doc(id);
      ref.get().then(doc => {
        if (doc.exists) {
          ref.update({
            players: firebase.firestore.FieldValue.arrayUnion(auth.currentUser.uid)
          });
          currentRoom = id;
          startGame(id);
        } else showMessage("Room not found");
      });
    };

    const waitForOpponent = (id) => {
      const ref = db.collection("rooms").doc(id);
      ref.onSnapshot(doc => {
        if (doc.data().players.length === 2) {
          startGame(id);
        }
      });
    };

    const startGame = (id) => {
      document.getElementById("friendMode").classList.add("hidden");
      document.getElementById("game").classList.remove("hidden");
      const boardEl = document.getElementById("board");
      boardEl.innerHTML = "";
      for (let i = 0; i < 9; i++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.dataset.index = i;
        cell.onclick = () => makeMove(i);
        boardEl.appendChild(cell);
      }

      db.collection("rooms").doc(id).onSnapshot(doc => {
        const data = doc.data();
        const board = data.board;
        isMyTurn = data.turn === auth.currentUser.uid;
        document.getElementById("playerTurn").innerText = isMyTurn ? "Your Turn" : "Opponent's Turn";
        board.forEach((val, i) => {
          boardEl.children[i].innerText = val;
        });
        checkWin(board);
      });
    };

    const makeMove = (index) => {
      const ref = db.collection("rooms").doc(currentRoom);
      ref.get().then(doc => {
        const data = doc.data();
        if (data.board[index] === "" && data.turn === auth.currentUser.uid) {
          const symbol = data.players.indexOf(auth.currentUser.uid) === 0 ? "X" : "O";
          const newBoard = data.board;
          newBoard[index] = symbol;
          const nextTurn = data.players.find(uid => uid !== auth.currentUser.uid);
          ref.update({ board: newBoard, turn: nextTurn });
        }
      });
    };

    const checkWin = (b) => {
      const winLines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
      for (const [a,b1,c] of winLines) {
        if (b[a] && b[a] === b[b1] && b[a] === b[c]) {
          showMessage(b[a] + " Wins!");
          setTimeout(() => location.reload(), 2000);
          return;
        }
      }
      if (b.every(c => c)) {
        showMessage("It's a Tie!");
        setTimeout(() => location.reload(), 2000);
      }
    };

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        document.getElementById("auth").classList.add("hidden");
        document.getElementById("dashboard").classList.remove("hidden");
        loadUsername();
      }
    });
  </script>
</body>
</html>
