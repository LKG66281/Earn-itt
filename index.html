<!-- Due to message size limitations, I’ll split the full code across several replies. Here’s Part 1 (Login + UI + Style + Firebase config): -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tic-Tac-Toe Multiplayer</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0a0a0a;
      color: #0ff;
    }
    .glow {
      color: #0ff;
      text-shadow: 0 0 5px #0ff, 0 0 10px #0ff;
    }
    .container {
      padding: 20px;
      text-align: center;
    }
    input, button {
      padding: 10px;
      margin: 10px;
      border: none;
      border-radius: 5px;
      background: #111;
      color: #0ff;
      box-shadow: 0 0 5px #0ff;
    }
    button:hover {
      background: #0ff;
      color: #000;
    }
    #game-board {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      grid-gap: 5px;
      justify-content: center;
      margin: 20px 0;
    }
    .cell {
      width: 100px;
      height: 100px;
      background: #111;
      color: #0ff;
      font-size: 2em;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 0 5px #0ff;
    }
    .hidden {
      display: none;
    }
    #messageBox {
      margin-top: 15px;
      padding: 10px;
      background: #111;
      border-radius: 5px;
      box-shadow: 0 0 5px #0ff;
    }
    .flex-col {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .dashboard {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="glow">Tic-Tac-Toe Multiplayer</h1>

    <div id="auth-section" class="flex-col">
      <input type="email" id="email" placeholder="Email" />
      <input type="password" id="password" placeholder="Password" />
      <button onclick="login()">Login</button>
      <button onclick="signup()">Signup</button>
      <p><a href="#" onclick="toggleLogin()">Already have an account?</a></p>
    </div>

    <div id="dashboard" class="hidden flex-col">
      <p>Welcome, <span id="user-email"></span></p>
      <input type="text" id="username" placeholder="Set Username" />
      <button onclick="setUsername()">Save Username</button>

      <div class="dashboard">
        <button onclick="showPlayOptions()">Play</button>
        <div id="play-options" class="hidden">
          <button onclick="startRandomMatch()">Random Match</button>
          <button onclick="showFriendOptions()">Play With Friend</button>
        </div>

        <div id="friend-options" class="hidden">
          <input type="text" id="room-id" placeholder="Room ID" />
          <button onclick="createRoom()">Create Room</button>
          <button onclick="joinRoom()">Join Room</button>
        </div>
      </div>

      <div id="stats">
        <p>Games Played: <span id="played">0</span></p>
        <p>Wins: <span id="wins">0</span></p>
        <p>Losses: <span id="losses">0</span></p>
        <p>Ties: <span id="ties">0</span></p>
      </div>
      <button onclick="logout()">Logout</button>
    </div>

    <div id="game-section" class="hidden">
      <h2 id="game-status"></h2>
      <div id="game-board"></div>
    </div>

    <div id="messageBox" class="glow hidden"></div>
  </div>

  <!-- Firebase Scripts -->
  <script type="module">
    // Firebase Config – Replace with your own
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot, addDoc, collection, deleteDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";

    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDs2taPm-p2O-dYdBToYwq7vZBUSDNISyg",
  authDomain: "earn-itt.firebaseapp.com",
  projectId: "earn-itt",
  storageBucket: "earn-itt.firebasestorage.app",
  messagingSenderId: "785360520679",
  appId: "1:785360520679:web:ac2e2710ece34591a52942",
  measurementId: "G-P4Q2KYTBBM"
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();

    // Continue in next message...
    // Utility functions
    const qs = (id) => document.getElementById(id);
    const show = (el) => el.classList.remove("hidden");
    const hide = (el) => el.classList.add("hidden");
    const msgBox = qs("messageBox");

    function showMessage(msg) {
      msgBox.textContent = msg;
      show(msgBox);
      setTimeout(() => hide(msgBox), 3000);
    }

    // Auth
    async function login() {
      const email = qs("email").value;
      const password = qs("password").value;
      await signInWithEmailAndPassword(auth, email, password);
    }

    async function signup() {
      const email = qs("email").value;
      const password = qs("password").value;
      await createUserWithEmailAndPassword(auth, email, password);
    }

    async function logout() {
      await signOut(auth);
    }

    function toggleLogin() {
      qs("email").value = "";
      qs("password").value = "";
    }

    let currentUser = null;
    let roomUnsub = null;
    let roomId = "";
    let isMyTurn = false;
    let symbol = "";
    let gameEnded = false;

    // Auth state
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        show(qs("dashboard"));
        hide(qs("auth-section"));
        qs("user-email").textContent = user.email;
        loadUsername();
        loadStats();
      } else {
        currentUser = null;
        show(qs("auth-section"));
        hide(qs("dashboard"));
        hide(qs("game-section"));
      }
    });

    async function setUsername() {
      const name = qs("username").value.trim();
      if (name) {
        const userRef = doc(db, "users", currentUser.uid);
        await setDoc(userRef, { username: name }, { merge: true });
        showMessage("Username saved!");
      }
    }

    async function loadUsername() {
      const userRef = doc(db, "users", currentUser.uid);
      const snap = await getDoc(userRef);
      if (snap.exists()) {
        const data = snap.data();
        qs("username").value = data.username || "";
      }
    }

    async function loadStats() {
      const userRef = doc(db, "users", currentUser.uid);
      const snap = await getDoc(userRef);
      if (snap.exists()) {
        const data = snap.data();
        qs("played").textContent = data.played || 0;
        qs("wins").textContent = data.wins || 0;
        qs("losses").textContent = data.losses || 0;
        qs("ties").textContent = data.ties || 0;
      }
    }

    function showPlayOptions() {
      show(qs("play-options"));
    }

    function showFriendOptions() {
      show(qs("friend-options"));
    }

    function createBoard() {
      const board = qs("game-board");
      board.innerHTML = "";
      for (let i = 0; i < 9; i++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.dataset.index = i;
        cell.onclick = () => handleMove(i);
        board.appendChild(cell);
      }
    }

    function updateBoard(state) {
      const cells = document.querySelectorAll(".cell");
      state.forEach((val, i) => {
        cells[i].textContent = val;
      });
    }

    function handleMove(index) {
      if (!isMyTurn || gameEnded) return;
      const roomRef = doc(db, "rooms", roomId);
      getDoc(roomRef).then(snap => {
        const data = snap.data();
        if (data.board[index] === "") {
          data.board[index] = symbol;
          data.turn = data.turn === "X" ? "O" : "X";
          updateDoc(roomRef, { board: data.board, turn: data.turn });
        }
      });
    }

    function checkGameOver(board) {
      const wins = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      for (let combo of wins) {
        const [a, b, c] = combo;
        if (board[a] && board[a] === board[b] && board[b] === board[c]) return board[a];
      }
      return board.includes("") ? null : "Tie";
    }

    async function updateStats(result) {
      const userRef = doc(db, "users", currentUser.uid);
      const snap = await getDoc(userRef);
      const data = snap.data();
      const updates = {
        played: (data.played || 0) + 1,
        wins: (data.wins || 0),
        losses: (data.losses || 0),
        ties: (data.ties || 0)
      };
      if (result === "win") updates.wins++;
      else if (result === "lose") updates.losses++;
      else updates.ties++;
      await updateDoc(userRef, updates);
      loadStats();
    }

    function playGame(roomData) {
      hide(qs("dashboard"));
      show(qs("game-section"));
      createBoard();
      roomId = roomData.id;
      symbol = roomData.X === currentUser.uid ? "X" : "O";
      isMyTurn = roomData.turn === symbol;
      gameEnded = false;
      qs("game-status").textContent = `${symbol === "X" ? "You are X" : "You are O"}`;

      roomUnsub = onSnapshot(doc(db, "rooms", roomId), (snap) => {
        const data = snap.data();
        updateBoard(data.board);
        const winner = checkGameOver(data.board);
        if (winner && !gameEnded) {
          gameEnded = true;
          let result = "tie";
          if (winner === symbol) result = "win";
          else if (winner !== "Tie") result = "lose";
          showMessage(result.toUpperCase());
          updateStats(result);
          setTimeout(() => {
            roomUnsub();
            deleteDoc(doc(db, "rooms", roomId));
            show(qs("dashboard"));
            hide(qs("game-section"));
          }, 3000);
        }
        isMyTurn = data.turn === symbol;
      });
    }

    // Final part with matchmaking (random + friend)
    // Coming up next...
    // Random Matchmaking
    async function randomMatch() {
      showMessage("Searching for opponent...");
      const matchRef = collection(db, "matchmaking");
      const q = query(matchRef, limit(1));
      const snap = await getDocs(q);

      if (snap.empty) {
        // No one waiting, add self
        const docRef = await addDoc(matchRef, {
          uid: currentUser.uid,
          timestamp: Date.now()
        });

        const unsub = onSnapshot(doc(db, "matchmaking", docRef.id), async (docSnap) => {
          const data = docSnap.data();
          if (data && data.matched) {
            unsub();
            await deleteDoc(docRef);
            playGame({ id: data.roomId, ...data });
          }
        });

        // Timeout if no one joins
        setTimeout(async () => {
          const matchSnap = await getDoc(docRef);
          if (matchSnap.exists()) {
            await deleteDoc(docRef);
            showMessage("No match found.");
          }
        }, 20000);

      } else {
        // Match with someone
        const other = snap.docs[0];
        const otherData = other.data();
        const roomRef = await addDoc(collection(db, "rooms"), {
          X: otherData.uid,
          O: currentUser.uid,
          board: ["", "", "", "", "", "", "", "", ""],
          turn: "X"
        });
        await updateDoc(other.ref, {
          matched: true,
          roomId: roomRef.id
        });
        playGame({ id: roomRef.id, X: otherData.uid, O: currentUser.uid, turn: "X", board: ["", "", "", "", "", "", "", "", ""] });
      }
    }

    // Friend Matchmaking
    async function createFriendRoom() {
      const roomRef = await addDoc(collection(db, "rooms"), {
        X: currentUser.uid,
        O: null,
        board: ["", "", "", "", "", "", "", "", ""],
        turn: "X"
      });
      showMessage(`Room ID: ${roomRef.id}`);
      const unsub = onSnapshot(roomRef, (snap) => {
        const data = snap.data();
        if (data.O) {
          unsub();
          playGame({ id: roomRef.id, ...data });
        }
      });
    }

    async function joinFriendRoom() {
      const roomId = prompt("Enter Room ID:");
      if (!roomId) return;
      const roomRef = doc(db, "rooms", roomId);
      const snap = await getDoc(roomRef);
      if (!snap.exists()) return showMessage("Room not found.");
      const data = snap.data();
      if (data.O) return showMessage("Room full.");
      await updateDoc(roomRef, { O: currentUser.uid });
      playGame({ id: roomId, ...data, O: currentUser.uid });
    }
  </script>
</body>
</html>
